# è®¾è®¡æ¨¡å¼ç¬¬ä¹èŠ‚

## 1. è£…é¥°å™¨æ¨¡å¼

### å¼•è¨€

ä»Šå¤©ä¸€ä¸ªå¤§ç‰›é—®äº†æˆ‘ä¸€ä¸ªé—®é¢˜ï¼šâ€œ`ä½ å¯¹äºç¼–ç¨‹è¿˜æœ‰æ„Ÿè§‰å—?`â€

å¾ˆå¤šåŒå­¦å¯¹äºä»£ç å·²ç»æ²¡æœ‰æ„Ÿè§‰äº†ï¼Œä¹Ÿå°±æ˜¯é™¤äº†å¯ä»¥æŠŠåŠŸèƒ½æŒ‰ç…§å›ºå®šçš„æµç¨‹ç¼–å†™å‡ºæ¥ï¼Œå†™å‡ºé‚£äº›æµæ°´å¼çš„ä»£ç å¤–ï¼Œå·²ç»å¾ˆéš¾å»æ€è€ƒæ•´ä¸€å¥—åŠŸèƒ½æœåŠ¡çš„æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§äº†ã€‚å°¤å…¶æ˜¯é¢å¯¹ä¸€äº›è¾ƒå¤§å‹çš„åŠŸèƒ½æ­å»ºä¸Šï¼Œæ¯”è¾ƒç¼ºå¤±ä¸€äº›é©¾é©­çš„èƒ½åŠ›ï¼Œä»è€Œå¯¼è‡´æœ€ç»ˆçš„ä»£ç æ¥è¯´ä¸èƒ½åšåˆ°å°½å–„å°½ç¾ã€‚

å¾€å¾€æˆ‘ä»¬å»å¼€å‘ç¼–ç¨‹å†™ä»£ç æ—¶ä¹Ÿç»å¸¸å°†ä¸€äº›ä¸æ°å½“çš„ç”¨æ³•ç”¨äºä¸šåŠ¡éœ€æ±‚å®ç°ä¸­ï¼Œä½†å´ä¸èƒ½æ„è¯†åˆ°ã€‚ä¸€æ–¹é¢æ˜¯ç”±äºç¼–ç ä¸å¤šç¼ºå°‘è¾ƒå¤§å‹é¡¹ç›®çš„å®è·µï¼Œå¦ä¸€æ–¹é¢æ˜¯ä¸æ€è¿›å–çš„æ€»åœ¨ä»¥å®Œæˆéœ€æ±‚ä¸ºç›®æ ‡ç¼ºå°‘ç²¾ç›Šæ±‚ç²¾çš„å·¥åŒ ç²¾ç¥ã€‚

### è£…é¥°å™¨æ¨¡å¼ä»‹ç»

![hkk4t.png](https://i.im5i.com/2021/03/27/hkk4t.png)

æ„Ÿè§‰ä»å›¾ç‰‡ä¸Šæ¥çœ‹ï¼Œè£…é¥°å™¨æ¨¡å¼å°±æ˜¯ä¿„ç½—æ–¯å¥—å¨ƒã€æŸæŸæ±½è½¦ğŸš—ï¼Œè€Œå®é™…ä¸Šè£…é¥°å™¨çš„æ ¸å¿ƒå°±æ˜¯ä¸å†æ”¹å˜åŸæœ‰çš„ç±»çš„åŸºç¡€ä¸Šç»™ç±»è¿›è¡Œæ·»åŠ æ–°åŠŸèƒ½ã€‚**ä¸æ”¹å˜åŸæœ‰çš„ç±»**ï¼Œå¯èƒ½å¤§éƒ¨åˆ†çš„åŒå­¦ä¼šæƒ³åˆ°ç»§æ‰¿ã€AOPåˆ‡é¢ï¼Œå½“ç„¶è¿™äº›æŠ€æœ¯éƒ½å¯ä»¥å®ç°ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨è£…é¥°å™¨è®¾è®¡æ¨¡å¼å°†ä¼šæ˜¯å¦ä¸€ä¸ªæ€è·¯æ›´ä¸ºçµæ´»ï¼Œå¯ä»¥é¿å…ç»§æ‰¿çš„å­ç±»è¿‡å¤šã€ä¹Ÿå¯ä»¥é¿å…AOPæ‰€å¸¦æ¥çš„å¤æ‚æ€§ã€‚

å…¶å®æˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§éƒ¨åˆ†åœºæ™¯éƒ½æ˜¯ä½¿ç”¨åˆ°äº†è£…é¥°å™¨æ¨¡å¼...

ä¾‹å¦‚ï¼š`new BufferedReader(new FileReader(""));`,è¿™æ®µæˆ‘ä»¬ç†Ÿæ‚‰çš„ä»£ç ï¼Œå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨javaå¼€å‘å­—èŠ‚æµã€å­—ç¬¦æµã€æ–‡ä»¶æµçš„å†…å®¹æ—¶éƒ½è§åˆ°äº†è¿™æ ·çš„ä»£ç ï¼Œä¸€å±‚åµŒå¥—ä¸€å±‚ï¼Œä¸€å±‚åµŒå¥—ä¸€å±‚ï¼Œå­—èŠ‚æµè½¬å­—ç¬¦æµç­‰ç­‰ï¼Œè€Œè¿™æ ·æ–¹å¼çš„ä½¿ç”¨å°±æ˜¯è£…é¥°å™¨æ¨¡å¼çš„ä¸€ç§ä½“ç°ã€‚

## 2. é¡¹ç›®ä»‹ç»

![w1FKq.png](https://i.im5i.com/2021/03/27/w1FKq.png)

åœ¨ä¸€èˆ¬çš„ä¸šåŠ¡å¼€å‘çš„åˆæœŸï¼Œå¾€å¾€å†…éƒ¨çš„ERPä½¿ç”¨ï¼Œåªéœ€è¦åˆ¤æ–­è´¦æˆ·éªŒè¯å³å¯ï¼ŒéªŒè¯é€šè¿‡åå³å¯è®¿é—®ERPçš„æ‰€æœ‰èµ„æºã€‚ä½†éšç€ä¸šåŠ¡çš„ä¸æ–­å‘å±•ï¼Œå›¢é˜Ÿé‡Œä¼šå‡ºç°ä¸“é—¨çš„è¿è¥äººå‘˜ã€è¥é”€äººå‘˜ã€æ•°æ®äººå‘˜ï¼Œæ¯ä¸ªäººå‘˜å¯¹äºERPéƒ½ä¼šäº§ç”Ÿä¸ä¸€æ ·çš„ä½¿ç”¨éœ€æ±‚ï¼Œæœ‰äº›éœ€è¦åˆ›å»ºæ´»åŠ¨ï¼Œæœ‰äº›åªæ˜¯æŸ¥çœ‹æ•°æ®ï¼ŒåŒæ—¶ä¸ºäº†ä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œä¸ä¼šè®©æ¯ä¸ªç”¨æˆ·éƒ½æœ‰æœ€é«˜çš„æƒé™ã€‚

é‚£ä¹ˆä»¥å‰æ‰€ä½¿ç”¨åˆ°çš„<kbd>SSO</kbd>æ˜¯ä¸€ä¸ªç»„ä»¶åŒ–é€šç”¨çš„æœåŠ¡ï¼Œä¸èƒ½åœ¨é‡Œé¢æ·»åŠ éœ€è¦çš„ç”¨æˆ·è®¿é—®éªŒè¯åŠŸèƒ½ã€‚ä½†è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œæ‰©å……åŸæœ‰çš„å•ç‚¹ç™»å½•æœåŠ¡ã€‚ä½†åŒæ—¶ä¹Ÿä¿è¯äº†åŸæœ‰çš„åŠŸèƒ½ä¸å—ç ´åï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚

### æ¨¡æ‹Ÿåœºæ™¯

**ç›®å½•ç»“æ„**

```markdown
- hcy-design-mode-decorator-mode-9-00
  - main
    - src
      - java
        - com 
          - hcy
            - HandlerInterceptor.java
            - SsoInterceptor.java
```

## 3. æ­£å¸¸è§£å†³æ–¹æ¡ˆ

### å¼•è¨€

```markdown
- ç»§æ‰¿ç±»çš„å®ç°æ–¹å¼ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„æ–¹å¼ï¼Œé€šè¿‡ç»§æ‰¿åé‡å†™æ–¹æ³•ï¼Œå¹¶å‘å°†è‡ªå·±çš„é€»è¾‘è¦†ç›–è¿›å»ã€‚

- å¦‚æœæ˜¯ä¸€äº›ç®€å•çš„åœºæ™¯ä¸”ä¸éœ€è¦ä¸æ–­ç»´æŠ¤å’Œæ‰©å±•çš„ï¼Œæ­¤ç±»å®ç°å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆï¼Œä¹Ÿä¸ä¼šå¯¼è‡´å­ç±»è¿‡å¤šã€‚
```

### ç›®å½•ç»“æ„

```markdown
- hcy-design-mode-decorator-mode-9-01
  - src
    - main
      - java
        - com
          - hcy
            - LoginSsoDecorator.java
```

### ä»£ç å®ç°

```java
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

/**
 * ç»§æ‰¿SSO
 * @author HCY
 * @since 2021/3/28 ä¸Šåˆ9:30
*/
public class LoginSsoDecorator extends SsoInterceptor {

    private static Map<String, String> authMap = new ConcurrentHashMap<String, String>();

    static {
        authMap.put("huahua", "queryUserInfo");
        authMap.put("doudou", "queryUserInfo");
    }

    @Override
    public boolean preHandle(String request, String response, Object handler) {
        // æ¨¡æ‹Ÿè·å–cookie
        String ticket = request.substring(1, 8);
        // æ¨¡æ‹Ÿæ ¡éªŒ
        boolean success = "success".equals(ticket);

        if (!success) {
            return false;
        }

        String userId = request.substring(9);
        String method = authMap.get(userId);

        // æ¨¡æ‹Ÿæ–¹æ³•æ ¡éªŒ
        return "queryUserInfo".equals(method);
    }
}
```

### æµ‹è¯•

**ä»£ç **

```java
@Test
public void shouldAnswerWithTrue() {
    LoginSsoDecorator ssoDecorator = new LoginSsoDecorator();
    String request = "1successxiaoxunyao";
    boolean success = ssoDecorator.preHandle(request, "ewcdqwt40liuiu", "t");
    System.out.println("ç™»å½•æ ¡éªŒï¼š" + request + (success ? " æ”¾è¡Œ" : " æ‹¦æˆª"));
}
```

**ç»“æœ**

```config
ç™»å½•æ ¡éªŒï¼š1successxiaoxunyao æ‹¦æˆª
```

## 4. è£…é¥°å™¨æ¨¡å¼ é‡æ„ä»£ç 

### å¼•è¨€

è£…é¥°å™¨ä¸»è¦è§£å†³çš„æ˜¯ç›´æ¥ç»§æ‰¿ä¸‹å› åŠŸèƒ½çš„ä¸æ–­æ¨ªå‘æ‰©å±•å¯¼è‡´å­ç±»è†¨èƒ€çš„é—®é¢˜ï¼Œè€Œæ˜¯ç”¨è£…é¥°å™¨æ¨¡å¼åå°±ä¼šæ¯”ç›´æ¥ç»§æ‰¿æ˜¾å¾—æ›´åŠ çµæ´»åŒæ—¶è¿™æ ·ä¹Ÿå°±ä¸å†éœ€è¦è€ƒè™‘å­ç±»çš„ç»´æŠ¤ã€‚

åœ¨è£…é¥°å™¨æ¨¡å¼ä¸­æœ‰å››ä¸ªæ¯”è¾ƒé‡è¦ç‚¹æŠ½è±¡å‡ºæ¥çš„ç‚¹ï¼›

```markdown
1. æŠ½è±¡æ„ä»¶è§’è‰²(Component) - `å®šä¹‰æŠ½è±¡æ¥å£`
2. å…·ä½“æ„ä»¶è§’è‰²(ConcreteComponent) - `å®ç°æŠ½è±¡æ¥å£ï¼Œå¯ä»¥æ˜¯ä¸€ç»„`
3. è£…é¥°è§’è‰²(Decorator) - `å®šä¹‰æŠ½è±¡ç±»å¹¶ç»§æ‰¿æ¥å£ä¸­çš„æ–¹æ³•ï¼Œä¿è¯ä¸€è‡´æ€§`
4. å…·ä½“è£…é¥°è§’è‰²(ConcreteDecorator) - `æ‰©å±•è£…é¥°å…·ä½“çš„å®ç°é€»è¾‘`
```
é€šè¿‡ä»¥ä¸Šè¿™å››é¡¹æ¥å®ç°è£…é¥°å™¨æ¨¡å¼ï¼Œä¸»è¦æ ¸å¿ƒå†…å®¹ä¼šä½“ç°åœ¨æŠ½è±¡ç±»çš„å®šä¹‰å’Œå®ç°ä¸Šã€‚

### ç›®å½•ç»“æ„

```markdown
- hcy-design-mode-decorator-mode-9-02
  - main
    - java
      - com
        - hcy
          - SsoDecorator.java
          - LoginSsoDecorator.java
```

### æ¨¡å‹ç»“æ„

![w1QHm.png](https://i.im5i.com/2021/03/28/w1QHm.png)

```markdown
- ä»¥ä¸Šæ˜¯ä¸€ä¸ªè£…é¥°å™¨å®ç°çš„ç±»å›¾ç»“æ„ï¼Œé‡ç‚¹çš„ç±»æ˜¯`SsoDecorator`ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ä¸»è¦å®Œæˆäº†å¯¹æ¥å£`HandlerInterceptor`ç»§æ‰¿ã€‚

- å½“è£…é¥°è§’è‰²ç»§æ‰¿æ¥å£åä¼šæä¾›æ„é€ å‡½æ•°ï¼Œå…¥å‚å°±æ˜¯ç»§æ‰¿çš„æ¥å£å®ç°ç±»å³å¯ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•å‡ºä¸åŒåŠŸèƒ½ç»„ä»¶ã€‚
```

### ä»£ç å®ç°

**æŠ½è±¡ç±»è£…é¥°è§’è‰²**

```java
public abstract class SsoDecorator implements HandlerInterceptor {
    private HandlerInterceptor handlerInterceptor;

    private SsoDecorator(){

    }

    public SsoDecorator(HandlerInterceptor handlerInterceptor) {
        this.handlerInterceptor = handlerInterceptor;
    }

    @Override
    public boolean preHandle(String request, String response, Object handler) {
        return handlerInterceptor.preHandle(request, response, handler);
    }
}
```

**è£…é¥°è§’è‰²é€»è¾‘å®ç°**

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public class LoginSsoDecorator extends SsoDecorator{
    private Logger logger = LoggerFactory.getLogger(LoginSsoDecorator.class);

    private static Map<String, String> authMap = new ConcurrentHashMap<String, String>();

    static {
        authMap.put("xiaoxunyao", "queryUserInfo");
        authMap.put("doudou", "queryUserInfo");
    }

    public LoginSsoDecorator(HandlerInterceptor handlerInterceptor) {
        super(handlerInterceptor);
    }

    @Override
    public boolean preHandle(String request, String response, Object handler) {
        boolean success = super.preHandle(request, response, handler);
        if (!success) {
            return false;
        }
        String userId = request.substring(8);
        String method = authMap.get(userId);
        logger.info("æ¨¡æ‹Ÿå•ç‚¹ç™»å½•æ–¹æ³•è®¿é—®æ‹¦æˆªæ ¡éªŒï¼š{} {}", userId, method);
        // æ¨¡æ‹Ÿæ–¹æ³•æ ¡éªŒ
        return "queryUserInfo".equals(method);
    }
}
```

### æµ‹è¯•

**æµ‹è¯•ä»£ç **

```java
@Test
public void shouldAnswerWithTrue() {
    LoginSsoDecorator ssoDecorator = new LoginSsoDecorator(new SsoInterceptor());
    String request = "1successxiaoxunyao";
    boolean success = ssoDecorator.preHandle(request, "ewcdqwt40liuiu", "t");
    System.out.println("ç™»å½•æ ¡éªŒï¼š" + request + (success ? " æ”¾è¡Œ" : " æ‹¦æˆª"));
}
```

**ç»“æœ**

```config
09:54:20.588 [main] INFO  com.hcy.LoginSsoDecorator - æ¨¡æ‹Ÿå•ç‚¹ç™»å½•æ–¹æ³•è®¿é—®æ‹¦æˆªæ ¡éªŒï¼šxiaoxunyao queryUserInfo
ç™»å½•æ ¡éªŒï¼š1successxiaoxunyao æ”¾è¡Œ
```

## 5. æ€»ç»“

```markdown
- ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼Œä½ å¯ä»¥åœ¨è‡ªå·±çš„è£…é¥°ç±»ä¸­å®ŒæˆåŠŸèƒ½é€»è¾‘çš„æ‰©å±•ï¼Œè€Œä¸å½±å“ä¸»ç±»ï¼ŒåŒæ—¶å¯ä»¥æŒ‰éœ€åœ¨è¿è¡Œæ—¶æ·»åŠ å’Œåˆ é™¤è¿™éƒ¨åˆ†é€»è¾‘ã€‚å¦å¤–è£…é¥°å™¨æ¨¡å¼ä¸ç»§æ‰¿çˆ¶ç±»é‡å†™æ–¹æ³•ï¼Œåœ¨æŸäº›æ—¶å€™éœ€è¦æŒ‰éœ€é€‰æ‹©ï¼Œå¹¶ä¸ä¸€å®šæŸä¸€ä¸ªå°±æ˜¯æœ€å¥½ã€‚

- è£…é¥°å™¨å®ç°çš„é‡ç‚¹æ˜¯å¯¹æŠ½è±¡ç±»ç»§æ‰¿æ¥å£æ–¹å¼çš„ä½¿ç”¨ï¼ŒåŒæ—¶è®¾å®šè¢«ç»§æ‰¿çš„æ¥å£å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’å…¶å®ç°ç±»ï¼Œç”±æ­¤å¢åŠ æ‰©å±•æ€§å¹¶é‡å†™æ–¹æ³•é‡Œå¯ä»¥å®ç°æ­¤éƒ¨åˆ†çˆ¶ç±»å®ç°çš„åŠŸèƒ½ã€‚
```

