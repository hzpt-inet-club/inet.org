# è®¾è®¡æ¨¡å¼ç¬¬åäº”èŠ‚

## è¿­ä»£å™¨æ¨¡å¼

### å¼•è¨€

æœ‰ä½å¤§ç‰›æœ‰ä¸€ä¸ªå£å¤´ç¦…ï¼šâ€œ`å°‘å¹´ï¼Œè¦æ‹¥æœ‰ç›¸ä¿¡çš„åŠ›é‡ï¼`â€

æˆ‘ä»¬ä»ä¸€ä¸ªæ‡µæ‡‚çš„å°‘å¹´ï¼Œåˆ°å¯ä»¥æ‹¿èµ·é”®ç›˜å¯ä»¥ç†Ÿç»ƒçš„å†™å‡º`HelloWorld`ã€‚å¤§å¤šæ•°çš„åŒå­¦éƒ½ä¸ä¼šè§‰å¾—è¿™æœ‰ä»€ä¹ˆéš¾åº¦ï¼Œä½†æ˜¯éšç€æ—¶é—´çš„å¢åŠ ï¼ŒåŒå­¦ä»¬æ‰€æ¥è§¦çš„åˆ°çš„éœ€æ±‚å¼€å‘è¶Šæ¥è¶Šåºå¤§ã€è¶Šæ¥è¶Šå¤æ‚ï¼Œç”šè‡³å¼€å§‹æœ‰äº†åˆ›æ–°çš„éœ€æ±‚ï¼Œä¹Ÿå¯èƒ½æŸ¥è¯¢å‡ å¤©å‡ å¤œçš„èµ„æ–™ğŸ’¾éƒ½æ²¡æœ‰ä»€ä¹ˆç»“æœã€‚è¿™ä¸ªæ—¶å€™çš„ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è€ƒè™‘è¿‡æ”¾å¼ƒï¼Œè¿˜æ˜¯ä¼šä¸€ç›´åšæŒä¸æ–­çš„çš„å°è¯•å®Œæˆè‡ªå·±çš„æƒ³æ³•ã€‚å¾€å¾€è¿™ç§æ¯«æ— å‰è½¦ä¹‹é‰´çš„é—®é¢˜éœ€è¦è‡ªå·±è§£å†³çš„æ—¶å€™ï¼Œå¯èƒ½çœŸçš„ä¼šæŠ˜ç£¨åˆ°è¦å´©æºƒï¼Œä½†ä½ è¦æ„¿æ„æ‰§ç€ã€æ„¿æ„å€”å¼ºï¼Œæ„¿æ„é€‰æ‹©ç›¸ä¿¡ç›¸ä¿¡çš„åŠ›é‡ï¼Œå°±ä¸€å®šèƒ½è§£å†³ã€‚å“ªæ€•è§£å†³ä¸äº†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™æ¡è·¯ä¸Šæ‘¸ç´¢å‡ºå…¶ä»–æ›´å¤šçš„æ”¶è·ï¼Œä¸ºåç»­å‰è¿›çš„é“è·¯å¡«å……å¥½å«è„šçŸ³ã€‚

è€äººä»¬å¸¸è¯´ï¼šâ€œ`æ—¶é—´ç´§å¹¶ä¸æ˜¯ä½ å†™å‡ºåƒåœ¾ä»£ç çš„ç†ç”±ã€‚`â€

<kbd>æ‹§èºä¸</kbd>ï¼Ÿ<kbd>âŒ˜+C</kbd>,<kbd>âŒ˜+V</kbd>ï¼Ÿè´´è†è¯ä¼¼çš„å†™ä»£ç ï¼Ÿè¿™æ˜¯å¤šå°‘åŒå­¦ä»¬åœ¨å·¥ä½œä¹‹åå†™ä»£ç æ—¶å€™çš„æ— å¥ˆä¹‹ä¸¾å‘¢ã€‚è¦èµ¶å·¥æœŸï¼Œèµ¶æ—¶é—´ã€‚å…¶å®å¤åˆ¶ç²˜è´´å‡ºæ¥çš„ä»£ç ä¹Ÿä¸ä¸€å®šä¼šå¿«çš„ï¼Œæ‹¼å‡‘å‡ºæ¥çš„CRUDä¹Ÿä¸è§å¾—æ˜¯æœ€ç¨³å®šçš„ã€‚å…¶å®å¤§å®¶éƒ½çŸ¥é“å¾ˆå°‘æœ‰ä¸€ä¸ªæ¶æ„æ¨¡å‹ä¼šé€‚åˆæ‰€æœ‰çš„åœºæ™¯ã€‚

è€äººä»¬å¸¸è¯´ï¼šâ€œ`ä¸è¦åªæ˜¯è®©è‡ªå·±æˆä¸ºä¸€ä¸ªå·¥å…·äººã€‚`â€

å› ä¸ºåŒå­¦ä»¬æœªæ¥çš„å·¥ä½œéƒ½æ˜¯ç¼–å†™ä¸šåŠ¡éœ€æ±‚ä»£ç ï¼Œå¯¼è‡´è‡ªå·±åƒä¸€ä¸ªå·¥å…·äººï¼Œä¹…è€Œä¹…ä¹‹ä¹Ÿå°±ä¸ä¼šå†å»å­¦ä¹ æŠ€æœ¯æ ˆäº†ã€‚çœ‹è§æœ‰è½®å­ã€æœ‰æ¡†æ¶ã€æœ‰ç»„ä»¶ã€å¼€ç®±å³ç”¨ï¼Œåè½¬ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä½“é‡ä¹Ÿä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚ä½†å¦‚æœä½ æƒ³è¦æ›´å¤šçš„æ”¶å…¥ï¼Œå“ªæ€•æ˜¯é‡å¤çš„é€ è½®å­ï¼Œä½ ä¹Ÿè¦å»å°è¯•é€ ä¸€ä¸ªï¼Œå°±ç®—ä¸ç”¨åˆ°ç”Ÿäº§ï¼Œè‡ªå·±ç©ç©æ€»å¯ä»¥å§ã€‚æœ‰äº›äº‹æƒ…åªæœ‰è‡ªå·±ç»å†è¿‡ï¼Œæ‰èƒ½æœ‰æœ€æ·±çš„æ„Ÿè§¦ï¼Œå‚ä¸è¿‡å®è·µè¿‡ï¼Œæ‰å¥½æ€»ç»“ç‚¹è¯„å­¦ä¹ ã€‚

### è¿­ä»£å™¨ä»‹ç»

![wjxnG.png](https://i.im5i.com/2021/04/22/wjxnG.png)

è¿­ä»£å™¨æ¨¡å¼å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„<kbd>iterator</kbd>éå†ã€‚è™½ç„¶æ„Ÿè§‰è¿™ä¸ªè®¾è®¡æ¨¡å¼ä¹Ÿä¸ä¼šé¢‘ç¹çš„è¿ç”¨åœ¨æˆ‘ä»¬çš„æ—¥å¸¸å¼€å‘ä¹‹ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬å´æ—¶é•¿ä¼šä½¿ç”¨åˆ°æˆ‘ä»¬çš„<kbd>list</kbd>é›†åˆã€‚å¦å¤–å¢å¼ºçš„forå¾ªç¯è™½ç„¶æ˜¯å¾ªç¯è¾“å‡ºæ•°æ®ï¼Œä½†æ˜¯ä»–ä¸æ˜¯è¿­ä»£å™¨æ¨¡å¼ã€‚è¿­ä»£å™¨æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯å®ç°<kbd>Iterable</kbd>æ¥å£ï¼Œé€šè¿‡<kbd>next</kbd>çš„æ–¹å¼è·å–é›†åˆå…ƒç´ ï¼ŒåŒæ—¶å…·å¤‡å¯¹å…ƒç´ çš„åˆ é™¤ç­‰æ“ä½œã€‚è€Œå¢å¼ºçš„forå¾ªç¯æ˜¯ä¸å¯ä»¥çš„ã€‚

è¿™ç§è®¾è®¡æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è®©æˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼ï¼Œéå†ä¸åŒçš„æ•°æ®ç»“æ„å…ƒç´ ï¼Œè¿™äº›æ•°æ®ç»“æ„åŒ…æ‹¬ï¼›`æ•°ç»„`ã€`é“¾è¡¨`ã€`æ ‘`ç­‰ï¼Œè€Œç”¨æˆ·åœ¨ä½¿ç”¨éå†çš„æ—¶å€™å¹¶ä¸éœ€è¦å»å…³å¿ƒæ¯ä¸€ç§æ•°æ®ç»“æ„çš„éå†å¤„ç†é€»è¾‘ï¼Œä»è®©ä½¿ç”¨å˜å¾—ç»Ÿä¸€æ˜“ç”¨ã€‚

## æ¡ˆä¾‹æ¨¡æ‹Ÿ

![wj87z.png](https://i.im5i.com/2021/04/22/wj87z.png)

***åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿè¿­ä»£éå†è¾“å‡ºå…¬å¸ä¸­æ ‘å½¢ç»“æ„çš„ç»„ç»‡æ¶æ„å…³ç³»ä¸­é›‡å‘˜åˆ—è¡¨***

å¤§éƒ¨åˆ†å…¬å¸çš„ç»„ç»‡æ¶æ„éƒ½æ˜¯é‡‘å­—å¡”ç»“æ„ï¼Œä¹Ÿå°±è¿™ç§æ ‘å½¢ç»“æ„ï¼Œåˆ†ä¸ºä¸€çº§ã€äºŒçº§ã€ä¸‰çº§ç­‰éƒ¨é—¨ï¼Œæ¯ä¸ªç»„ç»‡éƒ¨é—¨ç”±é›‡å‘˜å¡«å……ï¼Œæœ€ç»ˆä½“ç°å‡ºä¸€ä¸ªæ•´ä½“çš„æ ‘å½¢ç»„ç»‡æ¶æ„å…³ç³»ã€‚

ä¸€èˆ¬æˆ‘ä»¬å¸¸ç”¨çš„éå†å°±æ˜¯jdké»˜è®¤æä¾›çš„æ–¹æ³•ï¼Œå¯¹listé›†åˆéå†ã€‚ä½†æ˜¯å¯¹äºè¿™æ ·çš„åä¸šåŠ¡ç‰¹æ€§è¾ƒå¤§çš„æ ‘å½¢ç»“æ„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨åˆ°éå†ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‡ªå·±æ¥å®ç°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªç»„ç»‡å±‚æ¬¡å…³ç³»é€šè¿‡æ ‘å½¢æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å®Œæˆè¿­ä»£å™¨åŠŸèƒ½ã€‚

## è¿­ä»£å™¨æ¨¡å¼ é‡æ„ä»£ç 

### æ¶æ„æ¨¡å‹

åœ¨å®ç°è¿­ä»£å™¨æ¨¡å¼ä¹‹å‰å¯ä»¥å…ˆé˜…è¯»ä¸‹`java`ä¸­`list`æ–¹æ³•å…³äº`iterator`çš„å®ç°éƒ¨åˆ†ï¼Œå‡ ä¹æ‰€æœ‰çš„è¿­ä»£å™¨å¼€å‘éƒ½ä¼šæŒ‰ç…§è¿™ä¸ªæ¨¡å¼æ¥å®ç°ï¼Œè¿™ä¸ªæ¨¡å¼ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ å—ï¼›

```markdown
1. Collectionï¼Œé›†åˆæ–¹æ³•éƒ¨åˆ†ç”¨äºå¯¹è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„æ·»åŠ é€šç”¨æ–¹æ³•ï¼›`add`ã€`remove`ã€`iterator`ç­‰æ ¸å¿ƒæ–¹æ³•ã€‚

2. Iterableï¼Œæä¾›è·å–è¿­ä»£å™¨ï¼Œè¿™ä¸ªæ¥å£ç±»ä¼šè¢«`Collection`ç»§æ‰¿ã€‚

3. Iteratorï¼Œæä¾›äº†ä¸¤ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼›`hasNext`ã€`next`ï¼Œä¼šåœ¨å…·ä½“çš„æ•°æ®ç»“æ„ä¸­å†™å®ç°æ–¹å¼ã€‚
```

é™¤äº†è¿™æ ·é€šç”¨çš„è¿­ä»£å™¨å®ç°æ–¹å¼å¤–ï¼Œæˆ‘ä»¬çš„ç»„ç»‡å…³ç³»ç»“æ„æ ‘ï¼Œæ˜¯ç”±èŠ‚ç‚¹å’ŒèŠ‚ç‚¹é—´çš„å…³ç³»é“¾æ„æˆï¼Œæ‰€ä»¥ä¼šæ¯”ä¸Šè¿°çš„å†…å®¹å¤šä¸€äº›å…¥å‚ã€‚

### å·¥ç¨‹ç›®å½•

```markdown
- Iterator-pattern-1
  - src.main.com.hcy
    - group
      - Employee.java
      - GroupStructure.java
      - Link.java
    - lang
      - Collection.java
      - Iterable.java
      - Iterator.java
```

###  æ¨¡å‹ç»“æ„

![wjLV5.png](https://i.im5i.com/2021/04/22/wjLV5.png)

```markdown
- ä»¥ä¸Šæ˜¯æˆ‘ä»¬å·¥ç¨‹ç±»å›¾çš„æ¨¡å‹ç»“æ„ï¼Œå·¦ä¾§æ˜¯å¯¹è¿­ä»£å™¨çš„å®šä¹‰ï¼Œå³ä¾§æ˜¯åœ¨æ•°æ®ç»“æ„ä¸­å®ç°è¿­ä»£å™¨åŠŸèƒ½ã€‚

- å…³äºå·¦ä¾§éƒ¨åˆ†çš„å®ç°ä¸jdkä¸­çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯ä»¥äº’ç›¸å‚è€ƒï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰©å±•å­¦ä¹ ã€‚

- å¦å¤–è¿™ä¸ªéå†æ–¹å¼ä¸€ä¸ªæ ‘å½¢ç»“æ„çš„æ·±åº¦éå†ï¼Œä¸ºäº†å¯ä»¥æ›´åŠ è®©å­¦ä¹ çš„å°ä¼™ä¼´å®¹æ˜“ç†è§£ï¼Œè¿™é‡Œæˆ‘å®ç°äº†ä¸€ç§æ¯”è¾ƒç®€å•çš„æ ‘å½¢ç»“æ„æ·±åº¦éå†æ–¹å¼ã€‚åç»­è¯»è€…ä¹Ÿå¯ä»¥æŠŠéå†æ‰©å±•ä¸ºæ¨ªå‘éå†ä¹Ÿå°±æ˜¯å®½åº¦éå†ã€‚
```

### ä»£ç å®ç°

```java
/**
 * é›‡å‘˜
 * @author HCY
 * @since 2021/4/22 7:41 ä¸‹åˆ
*/
public class Employee {

    /**
     * ID
     */
    private String uId;

    /**
     * å§“å
     */
    private String name;

    /**
     * å¤‡æ³¨
     */
    private String desc;
    public Employee(String uId, String name) {
        this.uId = uId;
        this.name = name;
    }

    public Employee(String uId, String name, String desc) {
        this.uId = uId;
        this.name = name;
        this.desc = desc;
    }

    public String getuId() {
        return uId;
    }

    public void setuId(String uId) {
        this.uId = uId;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDesc() {
        return desc;
    }

    public void setDesc(String desc) {
        this.desc = desc;
    }
}
```

```java

/**
 * æ ‘èŠ‚ç‚¹é“¾è·¯
 * @author HCY
 * @since 2021/4/22 7:42 ä¸‹åˆ
*/
@Data
public class Link {

    /**
     * é›‡å‘˜ID
     */
    private String fromId;
    /**
     * é›‡å‘˜ID
     */
    private String toId;   
}
```

```java
/**
 * è¿­ä»£å™¨å®šä¹‰
 * @author HCY
 * @since 2021/4/22 7:43 ä¸‹åˆ
 */
public interface Iterator<E> {

    boolean hasNext();

    E next();
}
```

```java
/**
 * å¯è¿­ä»£æ¥å£å®šä¹‰
 * @author HCY
 * @since 2021/4/22 7:43 ä¸‹åˆ
*/
public interface Iterable<E> {
    Iterator<E> iterator();
}
```

```java
/**
 * é›†åˆåŠŸèƒ½æ¥å£å®šä¹‰
 * @author HCY
 * @since 2021/4/22 7:43 ä¸‹åˆ
*/
public interface Collection<E,L> extends Iterable<E> {
    boolean add(E e);

    boolean remove(E e);

    boolean addLink(String key, L l);

    boolean removeLink(String key);

    @Override
    Iterator<E> iterator();
}
```

```java
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
/**
 * è¿­ä»£å™¨åŠŸèƒ½å®ç°
 * @author HCY
 * @since 2021/4/22 7:44 ä¸‹åˆ
*/
public class GroupStructure implements Collection<Employee, Link> {
    /**
     * ç»„ç»‡IDï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç»„ç»‡é“¾çš„å¤´éƒ¨ID
     */
    private String groupId;
    /**
     * ç»„ç»‡åç§°
     */
    private String groupName;
    /**
     * é›‡å‘˜åˆ—è¡¨
     */
    private Map<String, Employee> employeeMap = new ConcurrentHashMap<String, Employee>();
    /**
     * ç»„ç»‡æ¶æ„å…³ç³»ï¼›id->list
     */
    private Map<String, List<Link>> linkMap = new ConcurrentHashMap<String, List<Link>>();
    /**
     * åå‘å…³ç³»é“¾
      */
    private Map<String, String> invertedMap = new ConcurrentHashMap<String, String>();

    public GroupStructure(String groupId, String groupName) {
        this.groupId = groupId;
        this.groupName = groupName;
    }

    @Override
    public boolean add(Employee employee) {
        return null != employeeMap.put(employee.getuId(), employee);
    }

    @Override
    public boolean remove(Employee employee) {
        return null != employeeMap.remove(employee.getuId());
    }

    @Override
    public boolean addLink(String key, Link link) {
        invertedMap.put(link.getToId(), link.getFromId());
        if (linkMap.containsKey(key)) {
            return linkMap.get(key).add(link);
        } else {
            List<Link> links = new LinkedList<Link>();
            links.add(link);
            linkMap.put(key, links);
            return true;
        }
    }

    @Override
    public boolean removeLink(String key) {
        return null != linkMap.remove(key);
    }

    @Override
    public Iterator<Employee> iterator() {
        return new Iterator<Employee>() {

            HashMap<String, Integer> keyMap = new HashMap<String, Integer>();

            int totalIdx = 0;
            private String fromId = groupId;  // é›‡å‘˜IDï¼ŒFrom
            private String toId = groupId;   // é›‡å‘˜IDï¼ŒTo

            @Override
            public boolean hasNext() {
                return totalIdx < employeeMap.size();
            }

            @Override
            public Employee next() {
                List<Link> links = linkMap.get(toId);
                int cursorIdx = getCursorIdx(toId);

                // åŒçº§èŠ‚ç‚¹æ‰«æ
                if (null == links) {
                    cursorIdx = getCursorIdx(fromId);
                    links = linkMap.get(fromId);
                }

                // ä¸Šçº§èŠ‚ç‚¹æ‰«æ
                while (cursorIdx > links.size() - 1) {
                    fromId = invertedMap.get(fromId);
                    cursorIdx = getCursorIdx(fromId);
                    links = linkMap.get(fromId);
                }

                // è·å–èŠ‚ç‚¹
                Link link = links.get(cursorIdx);
                toId = link.getToId();
                fromId = link.getFromId();
                totalIdx++;

                // è¿”å›ç»“æœ
                return employeeMap.get(link.getToId());
            }

            public int getCursorIdx(String key) {
                int idx = 0;
                if (keyMap.containsKey(key)) {
                    idx = keyMap.get(key);
                    keyMap.put(key, ++idx);
                } else {
                    keyMap.put(key, idx);
                }
                return idx;
            }
        };
    }
}
```

## æ€»ç»“

```markdown
- è¿­ä»£å™¨çš„è®¾è®¡æ¨¡å¼ä»ä»¥ä¸Šçš„åŠŸèƒ½å®ç°å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³äº†å•ä¸€èŒè´£å’Œå¼€é—­åŸåˆ™ï¼Œå¤–ç•Œçš„è°ƒç”¨æ–¹ä¹Ÿä¸éœ€è¦çŸ¥é“ä»»ä½•ä¸€ä¸ªä¸åŒçš„æ•°æ®ç»“æ„åœ¨ä½¿ç”¨ä¸Šçš„éå†å·®å¼‚ã€‚å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰©å±•ï¼Œä¹Ÿè®©æ•´ä¸ªéå†å˜å¾—æ›´åŠ å¹²å‡€æ•´æ´ã€‚

- ä½†ä»ç»“æ„çš„å®ç°ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè¿­ä»£å™¨æ¨¡å¼çš„å®ç°è¿‡ç¨‹ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒè´Ÿè´£çš„ï¼Œç±»çš„å®ç°ä¸Šä¹Ÿæ‰©å¢äº†éœ€è¦å¤–éƒ¨å®šä¹‰çš„ç±»ï¼Œä½¿å¾—éå†ä¸åŸæ•°æ®ç»“æ„åˆ†å¼€ã€‚è™½ç„¶è¿™æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œä½†å¯ä»¥çœ‹åˆ°åœ¨ä½¿ç”¨javaçš„jdkæ—¶å€™ï¼Œè¿­ä»£å™¨çš„æ¨¡å¼è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿æ‰©å±•å’Œå‡çº§ã€‚
```
